<?xml version="1.0" encoding="UTF-8"?>
<article title="Tequila.js" published="2019-01-12T13:28:01+09:00" updated="2019-01-12T13:28:01+09:00" category="JavaScript,CSV,TSV,SQL">
		<h1>Tequila.js</h1>
	
		
		
		
		<p>Text data query like SQL/LINQ<br/>
JavaScript で CSVなどをSQL風に操作できます。<br/>
		<a href="./resource/Tequilla.js" target="_blank" rel="noopener">source code</a></p>
	
	
		
		
		<pre>// DATA SOURCE SAMPLE (1)
"住所CD","都道府県CD","市区町村CD","町域CD","郵便番号","事業所フラグ","廃止フラグ","都道府県","都道府県カナ","市区町村","市区町村カナ","町域","町域カナ","町域補足","京都通り名","字丁目","字丁目カナ","補足","事業所名","事業所名カナ","事業所住所","新住所CD"
"980000000","4","4101","41010000","980-0000","0","0","宮城県","ミヤギケン","仙台市青葉区","センダイシアオバク","","　","（該当なし）","","","","","","","",""
"981091600","4","4101","41010001","981-0916","0","0","宮城県","ミヤギケン","仙台市青葉区","センダイシアオバク","青葉町","アオバマチ","","","","","","","","",""
"980085600","4","4101","41010002","980-0856","0","0","宮城県","ミヤギケン","仙台市青葉区","センダイシアオバク","青葉山","アオバヤマ","","","","","","","","",""
"989321100","4","4101","41010003","989-3211","0","0","宮城県","ミヤギケン","仙台市青葉区","センダイシアオバク","赤坂","アカサカ","","","","","","","","",""
"983004500","4","4102","41020071","983-0045","0","0","宮城県","ミヤギケン","仙台市宮城野区","センダイシミヤギノク","宮城野","ミヤギノ","","","","","","","","",""
"983852000","4","4102","41020071","983-8520","1","0","宮城県","ミヤギケン","仙台市宮城野区","センダイシミヤギノク","宮城野","ミヤギノ","","","","","","仙台医療センター","センダイイリヨウセンタ－","宮城野２丁目８－８",""
"983004400","4","4102","41020072","983-0044","0","0","宮城県","ミヤギケン","仙台市宮城野区","センダイシミヤギノク","宮千代","ミヤチヨ","","","","","","","","",""
"983086500","4","4102","41020073","983-0865","0","0","宮城県","ミヤギケン","仙台市宮城野区","センダイシミヤギノク","元寺小路","モトテラコウジ","","","","","","","","",""
"984000000","4","4103","41030000","984-0000","0","0","宮城県","ミヤギケン","仙台市若林区","センダイシワカバヤシク","","　","（該当なし）","","","","","","","",""
"984003200","4","4103","41030001","984-0032","0","0","宮城県","ミヤギケン","仙台市若林区","センダイシワカバヤシク","荒井","アライ","","","","","","","","",""
"984853000","4","4103","41030001","984-8530","1","0","宮城県","ミヤギケン","仙台市若林区","センダイシワカバヤシク","荒井","アライ","","","","","","ダイト薬品　株式会社","ダイトヤクヒン　カブシキガイシヤ","荒井矢取２１",""
"984003000","4","4103","41030081","984-0030","0","0","宮城県","ミヤギケン","仙台市若林区","センダイシワカバヤシク","荒井東","アライヒガシ","","","","","","","","",""
"982021300","4","4104","41040078","982-0213","0","0","宮城県","ミヤギケン","仙台市太白区","センダイシタイハクク","山田自由ケ丘","ヤマダジユウガオカ","","","","","","","","",""
"982081800","4","4104","41040081","982-0818","0","0","宮城県","ミヤギケン","仙台市太白区","センダイシタイハクク","山田新町","ヤマダシンマチ","","","","","","","","",""
"982081600","4","4104","41040079","982-0816","0","0","宮城県","ミヤギケン","仙台市太白区","センダイシタイハクク","山田本町","ヤマダホンチョウ","","","","","","","","",""
"982082200","4","4104","41040080","982-0822","0","0","宮城県","ミヤギケン","仙台市太白区","センダイシタイハクク","若葉町","ワカバマチ","","","","","","","","",""
"981310000","4","4105","41050000","981-3100","0","0","宮城県","ミヤギケン","仙台市泉区","センダイシイズミク","","　","（該当なし）","","","","","","","",""
"981311500","4","4105","41050001","981-3115","0","0","宮城県","ミヤギケン","仙台市泉区","センダイシイズミク","愛隣町","アイリンチョウ","","","","","","","","",""
"981310100","4","4105","41050002","981-3101","0","0","宮城県","ミヤギケン","仙台市泉区","センダイシイズミク","明石南","アカイシミナミ","","","","","","","","",""
"981311700","4","4105","41050007","981-3117","0","0","宮城県","ミヤギケン","仙台市泉区","センダイシイズミク","市名坂","イチナザカ","","","","","","","","",""
"986078100","4","4606","46060107","986-0781","0","0","宮城県","ミヤギケン","本吉郡南三陸町","モトヨシグンミナミサンリクチョウ","戸倉","トクラ","","","","","","","","",""
"986235300","4","4202","42020177","986-2353","0","0","宮城県","ミヤギケン","石巻市","イシノマキシ","桃浦","モモノウラ","","","","","","","","",""
"986240200","4","4202","42020178","986-2402","0","0","宮城県","ミヤギケン","石巻市","イシノマキシ","谷川浜","ヤガワハマ","","","","","","","","",""
"987110200","4","4202","42020185","987-1102","0","0","宮城県","ミヤギケン","石巻市","イシノマキシ","和渕","ワブチ","","","","","","","","",""
"985000000","4","4203","42030000","985-0000","0","0","宮城県","ミヤギケン","塩竈市","シオガマシ","","　","（該当なし）","","","","","","","",""
"985008200","4","4203","42030001","985-0082","0","0","宮城県","ミヤギケン","塩竈市","シオガマシ","青葉ケ丘","アオバガオカ","","","","","","","","",""
"985003100","4","4203","42030006","985-0031","0","0","宮城県","ミヤギケン","塩竈市","シオガマシ","石堂","イシドウ","","","","","","","","",""</pre>
	
	
		<p>SELECT</p>
	
	
	
		
		<pre>var q = new Tequila();
var a = q.parse(csv);
var b = q.from(a).where(function(e) {
    return /青葉区|泉区/.test(e["市区町村"]);
}).select("都道府県", "市区町村", "町域");

/* RESULT
宮城県, 仙台市青葉区,
宮城県, 仙台市青葉区, 青葉町
宮城県, 仙台市青葉区, 青葉山
宮城県, 仙台市青葉区, 赤坂
宮城県, 仙台市泉区,
宮城県, 仙台市泉区, 愛隣町
宮城県, 仙台市泉区, 明石南
宮城県, 仙台市泉区, 市名坂
*/</pre>
	
	
	
		<p>DISTINCT</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var c = q.from(a).where(function(e) {
    return e["市区町村"] == "仙台市太白区";
}).distinct("都道府県", "市区町村", "町域");

/*RESULT
宮城県, 仙台市太白区, 山田自由ケ丘
宮城県, 仙台市太白区, 山田新町
宮城県, 仙台市太白区, 山田本町
宮城県, 仙台市太白区, 若葉町
*/</pre>
	
	
		<p>GROUP BY</p>
	
	
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var g = q.from(a).where(function(e) {
    return /青葉区|泉区/.test(e["市区町村"]);
}).groupby("市区町村").select("都道府県", "市区町村", "町域");

/* RESULT
仙台市青葉区:
宮城県, 仙台市青葉区,
宮城県, 仙台市青葉区, 青葉町
宮城県, 仙台市青葉区, 青葉山
宮城県, 仙台市青葉区, 赤坂

仙台市泉区:
宮城県, 仙台市泉区,
宮城県, 仙台市泉区, 愛隣町
宮城県, 仙台市泉区, 明石南
宮城県, 仙台市泉区, 市名坂
*/</pre>
	
		<p>ORDER BY (ASCENDING)</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var z1 = q.from(a).where(function(e) {
    return e["市区町村"] == "仙台市泉区";
}).orderby("郵便番号").select("郵便番号", "市区町村", "町域");

/* RESULT
981-3100, 仙台市泉区,
981-3101, 仙台市泉区, 明石南
981-3115, 仙台市泉区, 愛隣町
981-3117, 仙台市泉区, 市名坂
*/</pre>
	
	
		<p>ORDER BY (DESCENDING)</p>
	
	
		
		<pre>var q = new Tequila();
var a = q.parse(csv);
var z1 = q.from(a).where(function(e) {
    return e["市区町村"] == "仙台市泉区";
}).orderby("郵便番号", "descending").select("郵便番号", "市区町村", "町域");

/* RESULT
981-3117, 仙台市泉区, 市名坂
981-3115, 仙台市泉区, 愛隣町
981-3101, 仙台市泉区, 明石南
981-3100, 仙台市泉区
*/</pre>
	
		<p>ORDER BY (with sort function)</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var z3 = q.from(a).where(function(e) {
    return e["市区町村"] == "仙台市泉区";
}).orderby(function(e1, e2) {
    if(e1["郵便番号"] == e2["郵便番号"]) {
        return 0;
    }
    return (e1["郵便番号"] &lt; e2["郵便番号"]) ? 1 : -1;
}).select("郵便番号", "市区町村", "町域");

/* RESULT
981-3117, 仙台市泉区, 市名坂
981-3115, 仙台市泉区, 愛隣町
981-3101, 仙台市泉区, 明石南
981-3100, 仙台市泉区
*/</pre>
	
	
		<p>COUNT</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var c1 = q.from(a).where(function(e) {
    return e["市区町村"] == "仙台市泉区";
}).count();

/* RESULT
4
*/</pre>
	
		
		
		<p>COUNT (with groupby)</p>
	
	
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var c2 = q.from(a).groupby("市区町村").count();

/* RESULT
仙台市青葉区:4
仙台市宮城野区:4
仙台市若林区:4
仙台市太白区:4
仙台市泉区:4
本吉郡南三陸町:1
石巻市:3
塩竈市:3
*/</pre>
	
	
		<p>MAX</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var m1 = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"])
}).max("住所CD");

/* RESULT
989321100
*/</pre>
	
	
		
		<p>MAX (with groupby)</p>
	
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var m2 = q.from(a).groupby("市区町村").max("住所CD");

/* RESULT
仙台市青葉区:989321100
仙台市宮城野区:983852000
仙台市若林区:984853000
仙台市太白区:982082200
仙台市泉区:981311700
本吉郡南三陸町:986078100
石巻市:987110200
塩竈市:985008200
*/</pre>
	
	
		<p>MIN</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var m3 = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"]);
}).min("住所CD");

/* RESULT
980000000
*/</pre>
	
		<p>MIN (with groupby)</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var m4 = q.from(a).groupby("市区町村").min("住所CD");

/* RESULT
仙台市青葉区:980000000
仙台市宮城野区:983004400
仙台市若林区:984000000
仙台市太白区:982021300
仙台市泉区:981310000
本吉郡南三陸町:986078100
石巻市:986235300
塩竈市:985000000
*/</pre>
	
		<p>AVERAGE</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var avg1 = q.from(a).where(function(e) {
    return /仙台市青葉区/.test(e["市区町村"]);
}).average("住所CD");

/* RESULT
982624575
*/</pre>
	
	
		<p>AVERAGE (with groupby)</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var avg2 = q.from(a).groupby("市区町村").average("住所CD");

/* RESULT
仙台市青葉区:982624575
仙台市宮城野区:983236850
仙台市若林区:984214800
仙台市太白区:982066725
仙台市泉区:981310825
本吉郡南三陸町:986078100
石巻市:986528566.6666666
塩竈市:985003766.6666666
*/</pre>
	
		<p>JOIN (INNER JOIN)</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var a1 = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"]);
}).select("住所CD", "都道府県CD", "市区町村CD", "町域CD");

var b1 = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"]);
}).select("住所CD", "郵便番号", "市区町村", "町域", "字丁目");

var j1 = q.from(a1).join(b1, "住所CD", "住所CD").select();

/*
980000000, 4, 4101, 41010000, 980-0000, 仙台市青葉区, ,
981091600, 4, 4101, 41010001, 981-0916, 仙台市青葉区, 青葉町,
980085600, 4, 4101, 41010002, 980-0856, 仙台市青葉区, 青葉山,
989321100, 4, 4101, 41010003, 989-3211, 仙台市青葉区, 赤坂
*/</pre>
	
	
		<p>LEFT OUTER JOIN</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var a2 = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"]);
}).orderby("郵便番号").select("住所CD");

var b2 = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"]);
}).select("住所CD", "郵便番号", "市区町村", "町域", "字丁目");

var j2 = q.from(a2).join(b2, "住所CD", "住所CD", true).select("住所CD", "市区町村", "町域", "字丁目");

/* RESULT
980000000, 仙台市青葉区, ,
980085600, 仙台市青葉区, 青葉山,
981091600, 仙台市青葉区, 青葉町,
981310000, null, null, null
981310100, null, null, null
981311500, null, null, null
981311700, null, null, null
989321100, 仙台市青葉区, 赤坂
*/</pre>
	
	
	
	
		<p>UNION</p>
	
	
	
		
		<pre>var s1 = q.union(b, c);

/* RESULT
宮城県, 仙台市青葉区,
宮城県, 仙台市青葉区, 青葉町
宮城県, 仙台市青葉区, 青葉山
宮城県, 仙台市青葉区, 赤坂
宮城県, 仙台市泉区,
宮城県, 仙台市泉区, 愛隣町
宮城県, 仙台市泉区, 明石南
宮城県, 仙台市泉区, 市名坂
宮城県, 仙台市太白区, 山田自由ケ丘
宮城県, 仙台市太白区, 山田新町
宮城県, 仙台市太白区, 山田本町
宮城県, 仙台市太白区, 若葉町
*/</pre>
	
	
		<p>UNION (ALL)</p>
	
		<pre>var s2 = q.union(b, c, true);

/* RESULT
宮城県, 仙台市青葉区,
宮城県, 仙台市青葉区, 青葉町
宮城県, 仙台市青葉区, 青葉山
宮城県, 仙台市青葉区, 赤坂
宮城県, 仙台市泉区,
宮城県, 仙台市泉区, 愛隣町
宮城県, 仙台市泉区, 明石南
宮城県, 仙台市泉区, 市名坂
宮城県, 仙台市太白区, 山田自由ケ丘
宮城県, 仙台市太白区, 山田新町
宮城県, 仙台市太白区, 山田本町
宮城県, 仙台市太白区, 若葉町
*/</pre>
	
	
		<p>INTERSECT</p>
	
	
		<pre>var s3 = q.intersect(b, c);</pre>
	
		
		
		<p>EXCEPT</p>
	
	
	
	
		
		<pre>var s4 = q.except(b, c);

/* RESULT
宮城県, 仙台市青葉区,
宮城県, 仙台市青葉区, 青葉町
宮城県, 仙台市青葉区, 青葉山
宮城県, 仙台市青葉区, 赤坂
宮城県, 仙台市泉区,
宮城県, 仙台市泉区, 愛隣町
宮城県, 仙台市泉区, 明石南
宮城県, 仙台市泉区, 市名坂
*/</pre>
	
		<p>DELETE</p>
	
	
		<pre>var q = new Tequila();
var a = q.parse(csv);
var r = q.from(a).where(function(e) {
    return /仙台市/.test(e["市区町村"]);
}).delete("都道府県", "市区町村", "町域");

/* RESULT
986078100, 4, 4606, 46060107, 986-0781, 0, 0, 宮城県, ミヤギケン, 本吉郡南三陸町, モトヨシグンミナミサンリクチョウ, 戸倉, トクラ, , , , , , , , ,
986235300, 4, 4202, 42020177, 986-2353, 0, 0, 宮城県, ミヤギケン, 石巻市, イシノマキシ, 桃浦, モモノウラ, , , , , , , , ,
986240200, 4, 4202, 42020178, 986-2402, 0, 0, 宮城県, ミヤギケン, 石巻市, イシノマキシ, 谷川浜, ヤガワハマ, , , , , , , , ,
987110200, 4, 4202, 42020185, 987-1102, 0, 0, 宮城県, ミヤギケン, 石巻市, イシノマキシ, 和渕, ワブチ, , , , , , , , ,
985000000, 4, 4203, 42030000, 985-0000, 0, 0, 宮城県, ミヤギケン, 塩竈市, シオガマシ, , 　, （該当なし）, , , , , , , ,
985008200, 4, 4203, 42030001, 985-0082, 0, 0, 宮城県, ミヤギケン, 塩竈市, シオガマシ, 青葉ケ丘, アオバガオカ, , , , , , , , ,
985003100, 4, 4203, 42030006, 985-0031, 0, 0, 宮城県, ミヤギケン, 塩竈市, シオガマシ, 石堂, イシドウ, , , , , , , , ,
*/</pre>
	
		<p>Parsing Text as Tabular Data</p>
	
		
		<pre>// DATA SOURCE SAMPLE (2)

X	列A	列B	列C	列D	列E	列F
行1	0	1	2	3	4	5
行2	0	1	2	3	4	5
行3	0	1	2	3	4	5
行4	0	1	2	3	4	5
行5	0	1	2	3	4	5</pre>
	
		
		<p>Parse as a Row-Major Table with Headers</p>
	
	
	
		<pre>var q = new Tequila();
var z = q.parse(tsv, {
    delimiter: "\t"
});

/* RESULT
行1, 0, 1, 2, 3, 4, 5
行2, 0, 1, 2, 3, 4, 5
行3, 0, 1, 2, 3, 4, 5
行4, 0, 1, 2, 3, 4, 5
行5, 0, 1, 2, 3, 4, 5
*/</pre>
	
	
		
		<p>Parse as a Row-Major Table without Header</p>
	
	
	
		<pre>var q = new Tequila();
var z = q.parse(tsv, {
    delimiter: "\t"
    hasHeaders: false
});

/* RESULT
X, 列A, 列B, 列C, 列D, 列E, 列F
行1, 0, 1, 2, 3, 4, 5
行2, 0, 1, 2, 3, 4, 5
行3, 0, 1, 2, 3, 4, 5
行4, 0, 1, 2, 3, 4, 5
行5, 0, 1, 2, 3, 4, 5
*/</pre>
	
	
		
		<p>Parse as a Column-Major Table with Headers</p>
	
	
	
		<pre>var q = new Tequila();
var z = q.parse(tsv, {
    delimiter: "\t",
    major: "column"
});

/* RESULT
列A, 0, 0, 0, 0, 0
列B, 1, 1, 1, 1, 1
列C, 2, 2, 2, 2, 2
列D, 3, 3, 3, 3, 3
列E, 4, 4, 4, 4, 4
列F, 5, 5, 5, 5, 5
*/</pre>
	
		
		<p>Parse as a Column-Major Table without Header</p>
	
	
	
		<pre>var q = new Tequila();
var z = q.parse(tsv, {
    delimiter: "\t",
    hasHeaders: false,
    major: "column"
});

/* RESULT
X, 行1, 行2, 行3, 行4, 行5
列A, 0, 0, 0, 0, 0
列B, 1, 1, 1, 1, 1
列C, 2, 2, 2, 2, 2
列D, 3, 3, 3, 3, 3
列E, 4, 4, 4, 4, 4
列F, 5, 5, 5, 5, 5
*/</pre>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	</article>
